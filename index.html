<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Keuangan Mobile</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#764ba2">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
        }
        .app-container {
            max-width: 100%;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        .app-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 15px; text-align: center; }
        
        /* NAVIGASI */
        .nav-tabs { display: grid; grid-template-columns: repeat(4, 1fr); background: #f8f9fa; border-bottom: 1px solid #ddd; }
        .nav-btn { background: none; border: none; padding: 15px 5px; font-size: 11px; font-weight: 600; color: #666; cursor: pointer; }
        .nav-btn.active { color: #667eea; border-bottom: 3px solid #667eea; background: #fff; }

        .screen { display: none; padding: 15px; flex-grow: 1; }
        .screen.active { display: block; }

        /* SEARCH BAR */
        .search-container { margin-bottom: 15px; position: relative; }
        .search-input { width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 20px; font-size: 14px; background: #f1f3f4; }

        /* FORM */
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 15px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-size: 15px; font-weight: 700; cursor: pointer; background: #667eea; color: white; }

        /* TABLE & CARDS */
        .summary-card { background: #764ba2; color: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: center; }
        .summary-amount { font-size: 20px; font-weight: 700; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .data-table th { background: #eee; padding: 10px; font-size: 11px; text-align: left; }
        .data-table td { padding: 12px 8px; border-bottom: 1px solid #eee; font-size: 12px; vertical-align: top; }
        
        /* TANGGAL & RIWAYAT (Sesuai Gambar) */
        .date-box { display: flex; flex-direction: column; line-height: 1.3; }
        .date-label { font-size: 9px; color: #888; text-transform: uppercase; font-weight: bold; }
        .payment-history-box { margin-top: 8px; padding: 8px; background: #f5f5f5; border-radius: 6px; }
        .history-item { font-size: 10px; color: #555; padding: 3px 0; border-bottom: 1px solid #e0e0e0; }
        .history-item:last-child { border-bottom: none; }

        .action-btn { padding: 8px; border-radius: 5px; border: none; font-size: 11px; font-weight: bold; width: 100%; margin-bottom: 5px; color: white; text-transform: uppercase; cursor: pointer; }
        .btn-pay { background: #28a745; }
        .btn-del { background: #dc3545; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 20px; display: none; z-index: 100; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="app-header">
        <h2>Keuangan Mobile</h2>
    </div>

    <div class="nav-tabs">
        <button class="nav-btn active" onclick="openScreen('transaksi', this)">âž• Input</button>
        <button class="nav-btn" onclick="openScreen('hutang', this)">ðŸ“‰ Hutang</button>
        <button class="nav-btn" onclick="openScreen('piutang', this)">ðŸ“ˆ Piutang</button>
        <button class="nav-btn" onclick="openScreen('backup', this)">ðŸ’¾ Backup</button>
    </div>

    <div id="transaksi" class="screen active">
        <form id="financeForm">
            <div class="form-group">
                <label class="form-label">Jenis</label>
                <select id="jenis" class="form-select">
                    <option value="hutang">Hutang</option>
                    <option value="piutang">Piutang</option>
                </select>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Tgl Pinjam</label>
                    <input type="date" id="tanggal" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Jatuh Tempo</label>
                    <input type="date" id="jatuh_tempo" class="form-input">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Nominal (Rp)</label>
                <input type="number" id="jumlah" class="form-input" placeholder="0" required>
            </div>
            <div class="form-group">
                <label class="form-label">Keterangan</label>
                <textarea id="keterangan" class="form-textarea" rows="2" placeholder="Nama / Keperluan"></textarea>
            </div>
            <button type="submit" class="btn">SIMPAN DATA</button>
        </form>
    </div>

    <div id="hutang" class="screen">
        <div class="summary-card">
            <p>Total Hutang</p>
            <div class="summary-amount" id="totalHutang">Rp 0</div>
        </div>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Cari nama atau keterangan..." onkeyup="filterData('listHutang', this.value)">
        </div>
        <div class="table-container">
            <table class="data-table">
                <thead><tr><th>Tgl / Tempo</th><th>Ket / Sisa</th><th>Aksi</th></tr></thead>
                <tbody id="listHutang"></tbody>
            </table>
        </div>
    </div>

    <div id="piutang" class="screen">
        <div class="summary-card" style="background: #28a745;">
            <p>Total Piutang</p>
            <div class="summary-amount" id="totalPiutang">Rp 0</div>
        </div>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Cari nama atau keterangan..." onkeyup="filterData('listPiutang', this.value)">
        </div>
        <div class="table-container">
            <table class="data-table">
                <thead><tr><th>Tgl / Tempo</th><th>Ket / Sisa</th><th>Aksi</th></tr></thead>
                <tbody id="listPiutang"></tbody>
            </table>
        </div>
    </div>

    <div id="backup" class="screen">
        <button class="btn" onclick="exportData()" style="background: #6c757d;">ðŸ“¥ Download Backup</button>
        <p style="margin-top:20px; font-size: 12px; font-weight: bold;">Restore Data:</p>
        <input type="file" class="form-input" accept=".json" onchange="importData(event)">
    </div>
</div>

<div id="toast" class="toast"></div>

<script>
    document.getElementById('tanggal').value = new Date().toISOString().split('T')[0];

    function openScreen(screenId, btn) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
        btn.classList.add('active');
        if(screenId !== 'transaksi' && screenId !== 'backup') renderData();
    }

    document.getElementById('financeForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const newData = {
            id: Date.now(),
            jenis: document.getElementById('jenis').value,
            tanggal: document.getElementById('tanggal').value,
            jatuh_tempo: document.getElementById('jatuh_tempo').value || '-',
            jumlah: parseFloat(document.getElementById('jumlah').value),
            terbayar: 0,
            riwayat: [],
            keterangan: document.getElementById('keterangan').value || '-'
        };
        const storage = JSON.parse(localStorage.getItem('keuangan_db')) || [];
        storage.push(newData);
        localStorage.setItem('keuangan_db', JSON.stringify(storage));
        this.reset();
        document.getElementById('tanggal').value = new Date().toISOString().split('T')[0];
        showToast("âœ… Tersimpan");
        const btn = document.querySelector(`.nav-btn[onclick*="${newData.jenis}"]`);
        openScreen(newData.jenis, btn);
    });

    function renderData() {
        const storage = JSON.parse(localStorage.getItem('keuangan_db')) || [];
        const listH = document.getElementById('listHutang');
        const listP = document.getElementById('listPiutang');
        listH.innerHTML = ''; listP.innerHTML = '';
        let sumH = 0, sumP = 0;

        storage.sort((a,b) => new Date(b.tanggal) - new Date(a.tanggal)).forEach(item => {
            const sisa = item.jumlah - item.terbayar;
            const row = `
                <tr class="data-row">
                    <td>
                        <div class="date-box">
                            <span class="date-label">PINJAM</span><span>${formatTgl(item.tanggal)}</span>
                            <span class="date-label" style="margin-top:5px">TEMPO</span>
                            <span style="color:${isOverdue(item.jatuh_tempo) ? 'red' : 'inherit'}">${formatTgl(item.jatuh_tempo)}</span>
                        </div>
                    </td>
                    <td class="searchable">
                        <strong>${item.keterangan}</strong><br>
                        Sisa: <b>${formatRp(sisa)}</b>
                        ${item.riwayat.length > 0 ? `<div class="payment-history-box">` + 
                            item.riwayat.map(r => `<div class="history-item">ðŸ“… ${formatTgl(r.tgl)}: ${formatRp(r.nom)} (${r.met})</div>`).join('') + 
                            `</div>` : ''}
                    </td>
                    <td style="width:75px">
                        ${sisa > 0 ? `<button class="action-btn btn-pay" onclick="payItem(${item.id})">BAYAR</button>` : '<span style="color:green;font-weight:bold">LUNAS</span>'}
                        <button class="action-btn btn-del" onclick="deleteItem(${item.id})">HAPUS</button>
                    </td>
                </tr>`;
            if(item.jenis === 'hutang') { listH.innerHTML += row; sumH += sisa; }
            else { listP.innerHTML += row; sumP += sisa; }
        });
        document.getElementById('totalHutang').textContent = formatRp(sumH);
        document.getElementById('totalPiutang').textContent = formatRp(sumP);
    }

    function filterData(targetId, query) {
        const rows = document.getElementById(targetId).getElementsByClassName('data-row');
        const q = query.toLowerCase();
        Array.from(rows).forEach(row => {
            const text = row.querySelector('.searchable').textContent.toLowerCase();
            row.style.display = text.includes(q) ? '' : 'none';
        });
    }

    function payItem(id) {
        const storage = JSON.parse(localStorage.getItem('keuangan_db'));
        const idx = storage.findIndex(i => i.id === id);
        const sisa = storage[idx].jumlah - storage[idx].terbayar;
        const nom = prompt("Nominal Bayar:", sisa);
        if(!nom || nom <= 0) return;
        const tgl = prompt("Tanggal Bayar:", new Date().toISOString().split('T')[0]);
        const met = prompt("Metode (Tunai/Transfer):", "Tunai");
        storage[idx].terbayar += parseFloat(nom);
        storage[idx].riwayat.push({ tgl, nom: parseFloat(nom), met });
        localStorage.setItem('keuangan_db', JSON.stringify(storage));
        renderData();
        showToast("ðŸ’° Pembayaran Dicatat");
    }

    function deleteItem(id) {
        if(confirm("Hapus permanen?")) {
            let storage = JSON.parse(localStorage.getItem('keuangan_db'));
            storage = storage.filter(i => i.id !== id);
            localStorage.setItem('keuangan_db', JSON.stringify(storage));
            renderData();
        }
    }

    function formatRp(v) { return "Rp " + new Intl.NumberFormat('id-ID').format(v); }
    function formatTgl(s) { 
        if(!s || s === '-') return '-';
        const d = s.split('-'); return d.length === 3 ? `${d[2]}/${d[1]}/${d[0]}` : s; 
    }
    function isOverdue(s) { return (s && s !== '-') ? new Date(s) < new Date().setHours(0,0,0,0) : false; }
    function showToast(m) { const t = document.getElementById('toast'); t.textContent = m; t.style.display = 'block'; setTimeout(()=>t.style.display='none', 2000); }
    
    function exportData() {
        const data = localStorage.getItem('keuangan_db') || '[]';
        const blob = new Blob([data], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `backup_keuangan_${Date.now()}.json`;
        a.click();
    }

    function importData(e) {
        const reader = new FileReader();
        reader.onload = (event) => {
            localStorage.setItem('keuangan_db', event.target.result);
            alert("Berhasil Restore!"); location.reload();
        };
        reader.readAsText(e.target.files[0]);
    }
</script>
</body>
</html>
